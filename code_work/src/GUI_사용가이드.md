# GUI 수동 보정 도구 사용 가이드

## 📖 개요

자동 매핑 결과를 검토하고 수동으로 보정할 수 있는 직관적인 GUI 도구입니다.

## 🖼️ GUI 구성 요소

### 1. 메인 화면 레이아웃
```
┌─────────────────────────────────────────────────────────────┐
│                  문항-이미지 매핑 보정 도구                    │
├────────────### ✅ **구현된 핵심 기능**
- **📋 매핑 목록**: 모든 문항-이미지 매핑을 표 형태로 표시
- **🖼️ 이미지 미리보기**: 선택한 매핑의 이미지를 실시간 미리보기
- **🔧 수정**: 잘못된 매핑을 올바른 이미지로 변경 + 문항 번호 수정 기능
- **❌ 삭제**: 불필요한 매핑 제거
- **➕ 추가**: 누락된 문항에 이미지 연결 (사용되지 않은 이미지만 표시)
- **📊 정렬**: 문항 ID 기준 오름차순/내림차순 정렬 (버튼 클릭 또는 헤더 클릭)
- **💾 저장**: 모든 변경사항 저장
- **🔍 자동 검증 기능**:
  - **중복 문항 검사**: 문항 번호 수정/추가 시 이미 존재하는 번호인지 확인
  - **누락된 문항 표시**: 1부터 최대 문항번호까지 중 빠진 번호를 자동으로 찾아서 표시
  - **이미지 중복 제거**: 같은 이미지가 여러 번 나타나지 않도록 자동 정리
  - **숫자 유효성 검사**: 문항 번호에 숫자가 아닌 값 입력 시 오류 메시지
- **🔄 자동 정렬 유지**: 문항 추가/수정 후에도 현재 정렬 상태 유지───┬───────────────────────────────────┤
│   📋 매핑 목록           │        🖼️ 이미지 미리보기          │
│  정렬: [문항 ID ↑][문항 ID ↓] 오름차순 정렬됨 ↑              │
│  ┌─────────────────────┐│  ┌─────────────────────────────────┐│
│  │ID(클릭하여 정렬)│문항번호│이미지파일││                      ││
│  ├─────────────────────┤│  │      클릭한 이미지가             ││
│  │question_1│1│img1.png ││  │      여기에 표시됩니다           ││
│  │question_2│2│img2.png ││  │                               ││
│  │    ...   │..│  ...   ││  │      (실시간 미리보기)           ││
│  └─────────────────────┘│  └─────────────────────────────────┘│
├─────────────────────────┴───────────────────────────────────┤
│  [수정]  [삭제]  [추가]                              [저장]  │
└─────────────────────────────────────────────────────────────┘
```

### 2. 핵심 기능별 버튼
- **🔧 수정**: 잘못된 매핑을 올바른 이미지로 변경 + 문항 번호 수정
- **❌ 삭제**: 불필요한 매핑 제거
- **➕ 추가**: 누락된 문항에 이미지 연결
- **� 정렬**: 문항 ID로 오름차순(↑) 또는 내림차순(↓) 정렬
- **�💾 저장**: 모든 변경사항 저장 및 종료

### 3. 정렬 기능
- **버튼 정렬**: `문항 ID ↑` / `문항 ID ↓` 버튼으로 원클릭 정렬
- **헤더 클릭 정렬**: "ID (클릭하여 정렬)" 헤더를 클릭하면 정렬 순서가 토글됨
- **정렬 상태 표시**: 현재 정렬 상태가 파란색 텍스트로 표시됨
- **자동 정렬 유지**: 문항 추가/수정 후에도 현재 정렬 순서 자동 유지

## 📋 사용 시나리오

### 시나리오 1: 잘못된 매핑 수정 🔧

**문제 상황**: `question_15`가 잘못된 이미지(`page_3_img_2.png`)에 연결되고, 실제로는 문항 번호도 23번이어야 함

**수정 과정**:
1. 매핑 목록에서 `question_15` 클릭
2. 우측 미리보기에서 현재 이미지 확인
3. **[수정]** 버튼 클릭
4. 수정 다이얼로그에서 문항 번호와 이미지 모두 수정
   ```
   ┌─────────────────────────────────────────────────────────┐
   │                매핑 수정: question_15                     │
   ├─────────────────────────────────────────────────────────┤
   │ 기존 문항 ID: question_15                               │
   │ 현재 이미지: page_3_img_2.png                           │
   ├─────────────────────────────────────────────────────────┤
   │ 📝 문항 번호 수정                                        │
   │ 문항 번호: [23] (예: 1, 2, 3... 숫자만 입력)             │
   ├─────────────────────────────────────────────────────────┤
   │ 📂 새 이미지 선택:                                       │
   │  □ page_3_img_1.png                                    │
   │  ☑ page_3_img_3.png ← 올바른 이미지                     │
   │  □ page_3_img_4.png                                    │
   ├─────────────────────────────────────────────────────────┤
   │                                          [적용] [취소]  │
   └─────────────────────────────────────────────────────────┘
   ```
5. **[적용]** 클릭하여 수정 완료

**결과**: `question_15` → `question_23` + `page_3_img_3.png`로 정정

---

### 시나리오 2: 누락된 매핑 추가 ➕

**문제 상황**: `question_23`이 자동 매핑에서 누락됨

**추가 과정**:
1. **[추가]** 버튼 클릭
2. 추가 다이얼로그에서 정보 입력
   ```
   ┌─────────────────────────────────────────────────────────┐
   │                    새 매핑 추가                          │
   ├─────────────────────────────────────────────────────────┤
   │ 📝 문항 정보                                            │
   │ 문항 번호: [23    ] (예: 1, 2, 3...)                    │
   │                          누락된 문항: 23, 31, 42 ←표시  │
   ├─────────────────────────────────────────────────────────┤
   │ 📂 이미지 선택                    │ 🖼️ 미리보기          │
   │ 사용 가능한 이미지:                │                     │
   │  □ page_5_img_1.png (사용됨)       │                     │
   │  ☑ page_5_img_2.png ← 선택        │   [이미지 표시]      │
   │  □ page_5_img_3.png (사용됨)       │                     │
   ├─────────────────────────────────────────────────────────┤
   │                                          [추가] [취소]  │
   └─────────────────────────────────────────────────────────┘
   ```
3. 문항 번호 `23` 입력
4. 적절한 이미지 선택 (미리보기로 확인)
5. **[추가]** 클릭하여 매핑 생성

**결과**: 새로운 매핑 `question_23` → `page_5_img_2.png` 추가

---

### 시나리오 3: 불필요한 매핑 삭제 ❌

**문제 상황**: `question_99`가 실제로는 존재하지 않는 문항

**삭제 과정**:
1. 매핑 목록에서 `question_99` 선택
2. **[삭제]** 버튼 클릭
3. 확인 다이얼로그에서 삭제 승인
   ```
   ┌─────────────────────────────────┐
   │            삭제 확인             │
   ├─────────────────────────────────┤
   │ question_99 매핑을              │
   │ 삭제하시겠습니까?                │
   │                                 │
   │           [예]    [아니오]       │
   └─────────────────────────────────┘
   ```
4. **[예]** 클릭하여 삭제 완료

**결과**: `question_99` 매핑이 목록에서 제거됨

---

### 시나리오 4: 정렬 기능 활용 📊

**상황**: 50개의 문항이 무작위 순서로 표시되어 있어 특정 문항을 찾기 어려움

**정렬 과정**:
1. **오름차순 정렬**: `[문항 ID ↑]` 버튼 클릭
   - question_1, question_2, question_3... 순서로 정렬
   - 상태 표시: "오름차순 정렬됨 ↑"

2. **내림차순 정렬**: `[문항 ID ↓]` 버튼 클릭  
   - question_50, question_49, question_48... 순서로 정렬
   - 상태 표시: "내림차순 정렬됨 ↓"

3. **헤더 클릭 토글**: "ID (클릭하여 정렬)" 헤더 클릭
   - 현재 오름차순이면 → 내림차순으로 변경
   - 현재 내림차순이면 → 오름차순으로 변경

4. **정렬 유지**: 문항 추가나 수정 후에도 현재 정렬 순서 자동 유지

**결과**: 원하는 순서로 정렬되어 문항을 쉽게 찾고 관리할 수 있음

## 🎯 실제 사용 예시

## 🚀 GUI 도구 실행 방법 

### **⭐ 추천 방법: 간편 실행**
```bash
cd code_work/src
python run_gui_correction.py
```
- ✅ 가장 쉽고 빠른 방법
- ✅ 매핑 파일 자동 탐지 및 선택
- ✅ 단계별 안내 제공

### **📋 실행 과정**
1. **명령어 실행** → 매핑 파일 목록 표시
2. **파일 선택** (번호 입력)
3. **GUI 창 자동 열림**
4. **매핑 보정 작업** (수정/삭제/추가)
5. **[저장] 버튼** → 완료

### **🔄 다른 실행 방법들**

#### 방법 2: 대화형 메뉴 사용
```bash
cd code_work/src
python run_mapping.py
```
메뉴에서 **"3. 기존 매핑 결과 검증"** 선택

#### 방법 3: 직접 프로그래밍
```python
from mapping_validator import create_manual_correction_interface
from pdf_image_extractor import load_mapping_from_json

# 매핑 파일 로드 → GUI 실행
mapping_result = load_mapping_from_json("data/results/사진형/mapping_results_사진형.json")
corrected_result = create_manual_correction_interface(mapping_result)
```

### **📋 실행 전 체크리스트**
- ✅ `cd code_work/src` 디렉토리에서 실행
- ✅ 매핑 결과 파일 존재: `data/results/*/mapping_results_*.json`
- ✅ 필수 패키지 설치: `tkinter`, `pillow` 등

## 🎯 실제 사용 예시

### **💻 실행 예시**
```bash
G:\내 드라이브\4_paper\72_2_license_llm_how\code_work\src> python run_gui_correction.py

🖱️ GUI 매핑 보정 도구
==================================================
📂 사용 가능한 매핑 파일:
  1. 사진형/mapping_results_사진형.json
  2. 일러스트/mapping_results_일러스트.json
  3. 안전표지/mapping_results_안전표지.json

파일 선택 (1-3): 1

🔄 매핑 파일 로드 중: mapping_results_사진형.json
   📊 총 매핑 수: 42개

🖱️ GUI 보정 도구를 실행합니다...
   💡 창이 열리면 매핑을 검토하고 수정하세요
   💡 완료 후 [저장] 버튼을 클릭하면 창이 닫힙니다

[GUI 창에서 보정 작업 수행]

✅ 보정 완료!
   📊 보정 전 매핑: 42개 → 보정 후 매핑: 45개
   📁 보정된 결과: data/results/사진형/mapping_results_사진형_corrected.json
   📁 보정된 CSV: data/results/사진형/question_image_mapping_corrected.csv
```

### **📊 보정 전후 비교**
```
📊 보정 전 (자동 매핑):
   총 문항: 45개
   매핑된 문항: 41개 (91.1%)
   누락: question_23, question_31, question_42, question_44
   
📊 보정 후 (수동 보정):
   총 문항: 45개  
   매핑된 문항: 45개 (100%)
   누락: 없음
   수정: question_15, question_28 이미지 교체
   추가: question_23, question_31, question_42, question_44
   삭제: question_99 (존재하지 않는 문항)
```

## 💡 보정 작업 팁

### 1. 효율적인 검증 순서
1. **자동 검증 리포트** 먼저 확인
2. **Error 상태 페이지**부터 우선 처리
3. **Warning 상태 페이지** 검토
4. **누락된 문항** 일괄 추가
5. **최종 검토** 후 저장

### 2. 이미지 매칭 기준
- **문항 내용**과 **이미지 내용** 일치 여부
- **페이지 위치** 고려 (같은 페이지 내 이미지 우선)
- **순서 일치** 여부 (문항 순서 = 이미지 순서)

### 3. 일반적인 오류 패턴
- **위치 오차**: 인접한 이미지와 뒤바뀜
- **페이지 경계**: 페이지 끝과 다음 페이지 시작 부분
- **복합 문항**: 하나의 이미지를 여러 문항이 공유
- **이미지 없는 문항**: 텍스트만 있는 문항 (삭제 필요)

## 🔍 현재 GUI 기능

### ✅ **구현된 핵심 기능**
- **📋 매핑 목록**: 모든 문항-이미지 매핑을 표 형태로 표시
- **🖼️ 이미지 미리보기**: 선택한 매핑의 이미지를 실시간 미리보기
- **🔧 수정**: 잘못된 매핑을 올바른 이미지로 변경 + 문항 번호 수정 기능
- **❌ 삭제**: 불필요한 매핑 제거
- **➕ 추가**: 누락된 문항에 이미지 연결 (사용되지 않은 이미지만 표시)
- **� 정렬**: 문항 ID 기준 오름차순/내림차순 정렬 (버튼 클릭 또는 헤더 클릭)
- **�💾 저장**: 모든 변경사항 저장
- **🔍 스마트 검증**: 중복 문항 검사, 누락된 문항 표시
- **🔄 자동 정렬 유지**: 문항 추가/수정 후에도 현재 정렬 상태 유지

### 🔄 **향후 개선 예정 기능**
- 페이지별 필터링
- 상태별 필터링 (오류/정상)
- 검색 기능 (문항 ID, 이미지명)
- 키보드 단축키
- 일괄 작업 (다중 선택)

## ⚠️ GUI 실행 문제 해결

### 1. GUI 창이 열리지 않는 경우
```bash
# tkinter 패키지 확인
python -c "import tkinter; print('tkinter 사용 가능')"

# Windows에서 tkinter 설치
# (대부분 Python과 함께 설치됨)
```

### 2. 이미지 미리보기 오류
```bash
# PIL/Pillow 재설치
pip install --upgrade pillow
```

### 3. 매핑 파일을 찾을 수 없는 경우
```bash
# 먼저 매핑 실행
python run_mapping.py

# 파일 경로 확인
ls -la ../../data/results/*/mapping_results_*.json
```

### 4. GUI 응답 없음 현상
- **원인**: 대용량 이미지 처리 중
- **해결**: 잠시 기다리거나 이미지 크기 줄이기

### 5. 권한 오류 발생시
```bash
# 관리자 권한으로 실행 (Windows)
# 또는 파일 권한 확인
```

## 🚀 빠른 시작 가이드

### **⚡ 5분 완성 가이드**

1. **패키지 설치**
```bash
cd code_work/src
pip install PyMuPDF opencv-python pillow pandas matplotlib numpy scipy
```

2. **자동 매핑 실행** (먼저 필요)
```bash
python run_mapping.py
# 메뉴에서 1 또는 2 선택하여 매핑 실행
```

3. **GUI 보정 도구 실행** ⭐
```bash
python run_gui_correction.py
```

4. **GUI 보정 작업**
   - 📋 매핑 목록에서 항목 클릭
   - 🖼️ 이미지 미리보기로 확인  
   - 🔧 [수정]/❌[삭제]/➕[추가] 버튼으로 보정
   - 💾 [저장] 버튼으로 완료

5. **결과 확인**
```
data/results/{파일타입}/
├── mapping_results_*.json              ← 원본
├── mapping_results_*_corrected.json    ← 📍 보정본
└── question_image_mapping_*_corrected.csv ← 📍 보정본 CSV
```

### **🎯 성과**
**95% (자동 매핑) → 100% (GUI 보정) 정확도 달성!**
